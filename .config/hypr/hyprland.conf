# ============================================================================
# Hyprland - Config principale
# ============================================================================
# Structure :
#   hyprland.conf       <- ce fichier, point d'entrée
#   theme.conf          <- généré par HyprWelcome, ne pas éditer
# ============================================================================

source = ~/.config/hypr/theme.conf


################
### MONITEURS ###
################

monitor = , preferred, auto, 1


###############
### PROGRAMS ###
###############

$terminal    = kitty
$fileManager = dolphin
$menu        = rofi -show drun
$panel       = ~/.local/bin/hyprwelcome


#################
### AUTOSTART ###
#################

exec-once = /usr/lib/xdg-desktop-portal-hyprland &
exec-once = waybar
exec-once = hyprpaper
exec-once = hypridle
exec-once = mako
exec-once = discord
exec-once = /usr/lib/polkit-kde-authentication-agent-1


###########################
### VARIABLES D'ENVIRON. ###
###########################

env = XCURSOR_SIZE, 24
env = HYPRCURSOR_SIZE, 24

# Forcer Wayland natif pour les apps compatibles
env = QT_QPA_PLATFORM, wayland
env = QT_WAYLAND_DISABLE_WINDOWDECORATION, 1
env = GDK_BACKEND, wayland,x11
env = SDL_VIDEODRIVER, wayland
env = CLUTTER_BACKEND, wayland
env = XDG_CURRENT_DESKTOP, Hyprland
env = XDG_SESSION_TYPE, wayland
env = XDG_SESSION_DESKTOP, Hyprland


#####################
### LOOK AND FEEL ###
#####################

general {
    gaps_in  = 4
    gaps_out = 8

    border_size = 2

    # Couleurs injectées par HyprWelcome via theme.conf
    # col.active_border et col.inactive_border sont définis dans theme.conf

    resize_on_border = true   # Redimensionner en glissant sur les bords
    allow_tearing    = false

    layout = dwindle
}

decoration {
    rounding       = 10
    rounding_power = 2

    active_opacity   = 1.0
    inactive_opacity = 0.85   # Légère transparence sur les fenêtres inactives

    shadow {
        enabled      = true
        range        = 12
        render_power = 3
        # color injectée par theme.conf
    }

    blur {
        enabled  = true
        size     = 4
        passes   = 2
        vibrancy = 0.17
    }
}

animations {
    enabled = true

    # Courbes
    bezier = easeOutQuint, 0.23, 1, 0.32, 1
    bezier = quick,        0.15, 0, 0.1,  1
    bezier = linear,       0,    0, 1,    1

    # Fenêtres — ouverture/fermeture simples
    animation = windows,    1, 4,   easeOutQuint
    animation = windowsIn,  1, 4,   easeOutQuint, popin 85%
    animation = windowsOut, 1, 2,   quick,        popin 85%

    # Workspaces — transition latérale sobre
    animation = workspaces, 1, 3.5, easeOutQuint, slide

    # Fade pour les layers (waybar, mako...)
    animation = layers,    1, 3, easeOutQuint
    animation = fade,      1, 3, quick

    # Bordures désactivées (géré par theme.conf)
    animation = border, 0
}

dwindle {
    pseudotile     = true
    preserve_split = true
    smart_split    = true   # Split automatique selon la forme de la fenêtre
}

misc {
    force_default_wallpaper = 0
    disable_hyprland_logo   = true
    focus_on_activate       = false  # Pas de vol de focus
    mouse_move_enables_dpms = true
    key_press_enables_dpms  = true
}


#############
### INPUT ###
#############

input {
    kb_layout = fr          # AZERTY
    kb_variant = azerty
    kb_options =

    follow_mouse = 1
    sensitivity  = 0

    # Délai de répétition des touches (ms) — utile pour la navigation clavier
    repeat_rate  = 30
    repeat_delay = 250

    touchpad {
        natural_scroll    = true
        tap-to-click      = true
        drag_lock         = true
        scroll_factor     = 0.8
    }
}


####################
### KEYBINDINGS  ###
####################

$mod = SUPER

# ─── Applications ─────────────────────────────────────────────────
bind = $mod,       Return, exec, $terminal
bind = $mod,       E,      exec, $panel
bind = $mod,       R,      exec, $menu
bind = $mod SHIFT, E,      exec, $fileManager
bind = $mod,       C,      killactive
bind = $mod,       V,      togglefloating
bind = $mod,       F,      fullscreen, 0         # plein écran
bind = $mod SHIFT, F,      fullscreen, 1         # faux plein écran (garde les gaps)
bind = $mod,       P,      pseudo                # dwindle pseudotile
bind = $mod,       M,      exec, hyprctl dispatch exit

# ─── Navigation entre fenêtres — flèches (actuel) ─────────────────
bind = $mod, left,  movefocus, l
bind = $mod, right, movefocus, r
bind = $mod, up,    movefocus, u
bind = $mod, down,  movefocus, d

# ─── Navigation entre fenêtres — vim ──────────────────────────────
# bind = $mod, H, movefocus, l
# bind = $mod, L, movefocus, r
# bind = $mod, K, movefocus, u
# bind = $mod, J, movefocus, d

# ─── Déplacement de fenêtres ──────────────────────────────────────
bind = $mod SHIFT, left,  movewindow, l
bind = $mod SHIFT, right, movewindow, r
bind = $mod SHIFT, up,    movewindow, u
bind = $mod SHIFT, down,  movewindow, d

# ─── Redimensionnement ────────────────────────────────────────────
binde = $mod CTRL, left,  resizeactive, -40 0
binde = $mod CTRL, right, resizeactive,  40 0
binde = $mod CTRL, up,    resizeactive, 0 -40
binde = $mod CTRL, down,  resizeactive, 0  40

# ─── Workspaces — navigation ──────────────────────────────────────
# Super + & à ) pour les workspaces 1 à 9 en AZERTY
bind = $mod, ampersand,  workspace, 1
bind = $mod, eacute,     workspace, 2
bind = $mod, quotedbl,   workspace, 3
bind = $mod, apostrophe, workspace, 4
bind = $mod, parenleft,  workspace, 5
bind = $mod, minus,      workspace, 6
bind = $mod, egrave,     workspace, 7
bind = $mod, underscore, workspace, 8
bind = $mod, ccedilla,   workspace, 9
bind = $mod, agrave,     workspace, 10

# Navigation workspace suivant/précédent
bind = $mod,       Tab,   workspace, e+1
bind = $mod SHIFT, Tab,   workspace, e-1
bind = $mod,       mouse_down, workspace, e+1
bind = $mod,       mouse_up,   workspace, e-1

# ─── Workspaces — déplacement de fenêtre ──────────────────────────
bind = $mod SHIFT, ampersand,  movetoworkspace, 1
bind = $mod SHIFT, eacute,     movetoworkspace, 2
bind = $mod SHIFT, quotedbl,   movetoworkspace, 3
bind = $mod SHIFT, apostrophe, movetoworkspace, 4
bind = $mod SHIFT, parenleft,  movetoworkspace, 5
bind = $mod SHIFT, minus,      movetoworkspace, 6
bind = $mod SHIFT, egrave,     movetoworkspace, 7
bind = $mod SHIFT, underscore, movetoworkspace, 8
bind = $mod SHIFT, ccedilla,   movetoworkspace, 9
bind = $mod SHIFT, agrave,     movetoworkspace, 10

# ─── Workspace spécial (scratchpad) ───────────────────────────────
# Utile pour une fenêtre qu'on veut masquer/afficher rapidement
bind = $mod,       S, togglespecialworkspace, scratch
bind = $mod SHIFT, S, movetoworkspace, special:scratch

# ─── Souris ───────────────────────────────────────────────────────
bindm = $mod, mouse:272, movewindow
bindm = $mod, mouse:273, resizewindow

# ─── Média & volume ───────────────────────────────────────────────
bindel = , XF86AudioRaiseVolume,  exec, wpctl set-volume -l 1 @DEFAULT_AUDIO_SINK@ 5%+
bindel = , XF86AudioLowerVolume,  exec, wpctl set-volume @DEFAULT_AUDIO_SINK@ 5%-
bindel = , XF86AudioMute,         exec, wpctl set-mute @DEFAULT_AUDIO_SINK@ toggle
bindel = , XF86AudioMicMute,      exec, wpctl set-mute @DEFAULT_AUDIO_SOURCE@ toggle
bindl  = , XF86AudioNext,         exec, playerctl next
bindl  = , XF86AudioPause,        exec, playerctl play-pause
bindl  = , XF86AudioPlay,         exec, playerctl play-pause
bindl  = , XF86AudioPrev,         exec, playerctl previous

# Luminosité (laptop)
bindel = , XF86MonBrightnessUp,   exec, brightnessctl -e4 -n2 set 5%+
bindel = , XF86MonBrightnessDown, exec, brightnessctl -e4 -n2 set 5%-

# ─── Screenshot ───────────────────────────────────────────────────
bind = ,      Print, exec, grimblast copy area         # sélection → presse-papier
bind = SHIFT, Print, exec, grimblast copy screen       # écran entier → presse-papier
bind = $mod,  Print, exec, grimblast save screen ~/Pictures/Screenshots/$(date +%Y%m%d_%H%M%S).png

# ─── Screenshot (Spectacle) ───────────────────────────────────────────────
bind = $mod SHIFT, P, exec, spectacle


##############################
### FENÊTRES ET WORKSPACES ###
##############################

# ─── Règles générales ─────────────────────────────────────────────

# Ignorer les demandes de maximisation
windowrule {
    name          = suppress-maximize-events
    match:class   = .*
    suppress_event = maximize
}

# Fix XWayland drag
windowrule {
    name            = fix-xwayland-drag
    match:class     = ^$
    match:title     = ^$
    match:xwayland  = true
    match:float     = true
    match:fullscreen = false
    match:pin       = false
    no_focus        = true
}

# ─── HyprWelcome ────────────────────────────────────────────────────
windowrule {
    name            = hyprwelcome
    match:class     = hyprwelcome
    float           = true
    center          = true
    size            = 640 480
    #stay_focused     = true
    dim_around       = true
}

windowrule {
    name            = survival-guide
    match:class     = survival-guide
    float           = true
    center          = true
    size            = 800 600
    #stay_focused     = true
    dim_around       = true
}

# ─── Fenêtres flottantes par défaut ───────────────────────────────
windowrule = float true, match:class avucontrol
windowrule = float true, match:class blueman-manager
windowrule = float true, match:class Paramètres du système.*

# ─── JetBrains — désactiver le blur (lisibilité code) ─────────────
windowrule = no_blur true, match:class jetbrains-.*
windowrule = opaque true, match:class jetbrains-.*

# # ─── HyprWelcome ────────────────────────────────────────────────────
# windowrule = float,        class:hyprwelcome
# windowrule = center,       class:hyprwelcome
# windowrule = size 640 480, class:hyprwelcome
# windowrule = stayfocused,  class:hyprwelcome
# windowrule = dimaround,    class:hyprwelcome
#
# # ─── Fenêtres flottantes par défaut ───────────────────────────────
# windowrule = float, class:avucontrol
# windowrule = float, class:blueman-manager
# windowrule = float, title:Paramètres du système.*
#
# # ─── JetBrains — désactiver le blur (lisibilité code) ─────────────
# windowrule = noblur, class:jetbrains-.*
# windowrule = opaque, class:jetbrains-.*

# ─── Organisation des workspaces ──────────────────────────────────
# 1 : neutre (point d'entrée, aucune app assignée)
# 2 : code   (JetBrains, Kitty)
# 3 : browser (Brave)
# 4 : communication (Discord)
# 5-10 : libres

# # ─── Brave ────────────────────────────────────────────────────────
# windowrulev2 = workspace 3 silent, class:(brave-browser)
#
# # ─── Discord ──────────────────────────────────────────────────────
# windowrulev2 = workspace 4 silent, class:(discord)
